{% extends "base.html" %}

{% block content %}
<style>
  .card {
    background: var(--card-bg, #fff);
    border-radius: 8px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    padding: 1.75rem;
  }
  .form-group { margin-bottom: 1rem; }
  label { display:block; margin-bottom: 0.4rem; font-weight:600; }
  input[type="text"], input[type="password"], select {
    width:100%;
    padding: .6rem .7rem;
    border-radius:6px;
    border:1px solid #d0d7de;
    box-sizing:border-box;
    font-size:1rem;
    background: var(--input-bg, #fff);
    color: var(--input-color, #111);
  }

  /* Force visible colors for selects/options */
  select, select option {
    color: #111 !important;
    background: #fff !important;
  }

  .btn { padding:.65rem .9rem; border-radius:6px; border:none; cursor:pointer; }
  .btn-success { background: #16a34a; color:#fff; }

  /* Password strength bar */
  .pw-meter {
    height: 8px;
    width: 100%;
    background: #e6e9ee;
    border-radius: 6px;
    overflow:hidden;
    margin-top: 0.5rem;
  }
  .pw-meter > i {
    display:block;
    height:100%;
    width:0%;
    transition: width 0.25s ease;
    background: linear-gradient(90deg,#ef4444,#f59e0b,#10b981);
  }
  .pw-note { font-size: .9rem; color:#6b7280; margin-top: .4rem; }
</style>

<div class="card" style="max-width: 640px; margin: 2rem auto;">
    <h2 style="text-align: center; margin-bottom: 1.25rem;">Register</h2>

    <form method="POST" id="registerForm" novalidate>
        <div class="form-group">
            <label for="role">Role</label>
            <select id="role" name="role" required>
                <option value="">-- Select Role --</option>
                <option value="patient">Patient</option>
                <option value="doctor">Doctor</option>
            </select>
        </div>

        <div class="form-group">
            <label for="name">Full Name</label>
            <input autocomplete="name" type="text" id="name" name="name" required>
        </div>

        <div class="form-group">
            <label for="username">Username</label>
            <input autocomplete="username" type="text" id="username" name="username" required>
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <!-- pattern enforces: min 8 chars, upper, lower, digit, special -->
            <input
                autocomplete="new-password"
                type="password"
                id="password"
                name="password"
                required
                pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}"
                title="Password must be at least 8 characters, include uppercase and lowercase letters, a number, and a special character."
            >
            <div class="pw-meter" aria-hidden="true"><i id="pwbar"></i></div>
            <div class="pw-note" id="pwNote">Password must be 8+ chars with uppercase, lowercase, number, and a special character.</div>
        </div>

        <button type="submit" class="btn btn-success" style="width: 100%; font-size: 1.05rem;">Register</button>
    </form>

    <p style="text-align: center; margin-top: 1rem;">
        Already have an account? <a href="/login" style="color: var(--primary, #2563eb);">Login here</a>
    </p>
</div>

<script>
  // Password strength indicator (client-side visual)
  const pw = document.getElementById('password');
  const bar = document.getElementById('pwbar');
  const note = document.getElementById('pwNote');
  function scorePassword(s) {
    let score = 0;
    if (!s) return score;
    if (s.length >= 8) score++;
    if (/[A-Z]/.test(s)) score++;
    if (/[a-z]/.test(s)) score++;
    if (/\d/.test(s)) score++;
    if (/[@$!%*?&]/.test(s)) score++;
    return score; // 0-5
  }
  pw.addEventListener('input', () => {
    const s = pw.value;
    const sc = scorePassword(s);
    const pct = Math.round((sc / 5) * 100);
    bar.style.width = pct + '%';
    if (sc <= 2) {
      bar.style.background = 'linear-gradient(90deg,#ef4444,#f97316)'; // red/orange
      note.textContent = 'Weak — try adding uppercase, numbers and a special character.';
    } else if (sc === 3 || sc === 4) {
      bar.style.background = 'linear-gradient(90deg,#f59e0b,#fbbf24)'; // yellow-ish
      note.textContent = 'Fair — include more variety for stronger password.';
    } else {
      bar.style.background = 'linear-gradient(90deg,#10b981,#059669)'; // green
      note.textContent = 'Strong password.';
    }
  });

  // Prevent form submission if password doesn't satisfy pattern
  document.getElementById('registerForm').addEventListener('submit', (e) => {
    const pwInput = pw.value;
    const pattern = new RegExp(pw.getAttribute('pattern'));
    if (!pattern.test(pwInput)) {
      e.preventDefault();
      alert('Password must be at least 8 characters and include uppercase, lowercase, number and special character.');
      pw.focus();
    }
  });
</script>
{% endblock %}
